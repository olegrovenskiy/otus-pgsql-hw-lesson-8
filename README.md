# otus-pgsql-hw-lesson-8

##    Домашнее задание
Настройка autovacuum с учетом особеностей производительности

##    Цель:
запустить нагрузочный тест pgbench
настроить параметры autovacuum
проверить работу autovacuum

##    Описание/Пошаговая инструкция выполнения домашнего задания:

1.    Создать инстанс ВМ с 2 ядрами и 4 Гб ОЗУ и SSD 10GB
2.    Установить на него PostgreSQL 15 с дефолтными настройками

    [root@mck-network-test ~]# psql -V
    psql (PostgreSQL) 15.5
    [root@mck-network-test ~]#

    [root@mck-network-test ~]# sudo -u postgres psql
    could not change directory to "/root": Permission denied
    psql (15.5)
    Type "help" for help.
    
    postgres=#


3.    Создать БД для тестов: выполнить pgbench -i postgres

Запустить pgbench -c8 -P 6 -T 60 -U postgres postgres
Применить параметры настройки PostgreSQL из прикрепленного к материалам занятия файла
Протестировать заново
Что изменилось и почему?
Создать таблицу с текстовым полем и заполнить случайными или сгенерированными данным в размере 1млн строк
Посмотреть размер файла с таблицей
5 раз обновить все строчки и добавить к каждой строчке любой символ
Посмотреть количество мертвых строчек в таблице и когда последний раз приходил автовакуум
Подождать некоторое время, проверяя, пришел ли автовакуум
5 раз обновить все строчки и добавить к каждой строчке любой символ
Посмотреть размер файла с таблицей
Отключить Автовакуум на конкретной таблице
10 раз обновить все строчки и добавить к каждой строчке любой символ
Посмотреть размер файла с таблицей
Объясните полученный результат
Не забудьте включить автовакуум)
Задание со *:
Написать анонимную процедуру, в которой в цикле 10 раз обновятся все строчки в искомой таблице.
Не забыть вывести номер шага цикла.
